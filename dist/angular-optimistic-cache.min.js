angular.module("rt.optimisticcache").factory("optimisticCache",function(){function a(a){return d[a]}function b(a,e,f){if(c(d,a,e),angular.isArray(e)&&f.populateChildren)for(var g=0;g<e.length;g++){var h=e[g];b(b(a+"/"+h[f.idField],h))}}function c(a,b,d){if(d)if(a[b]){var e=a[b];if(angular.isArray(e)){for(var f=0;f<d.length;f++)c(e,f,angular.copy(d[f]));e.length=d.length}else for(var g in d)e[g]=d[g]}else a[b]=d}var d={};return function(d,e,f){return f||(f={}),null==f.idField&&(f.idField="id"),null==f.populateChildren&&(f.populateChildren=!0),d.then(function(a){b(e,a,f)}),d.toScope=function(b,f){var g=a(e);return c(b,f,g),d.then(function(a){c(b,f,a)}),d.then(function(){return b[f]})},d}});